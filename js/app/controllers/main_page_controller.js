// Generated by CoffeeScript 1.10.0
(function() {
  var app;

  app = angular.module('myApp');

  app.filter('byTag', function() {
    return function(items, tag) {
      var currentTags, i, item, len, result;
      result = [];
      if (!tag) {
        items;
      } else {
        for (i = 0, len = items.length; i < len; i++) {
          item = items[i];
          currentTags = item.tags.map(function(tag) {
            console.log(tag.name);
            return tag.name;
          });
          if (currentTags.indexOf(tag) !== -1) {
            result.push(item);
          }
        }
      }
      return result;
    };
  });

  app.controller('mainCtrl', [
    '$scope', '$routeParams', 'getUser', 'getPosts', 'sendRating', 'getHighRate', 'SearchService', function($scope, $routeParams, getUser, getPosts, sendRating, getHighRate, SearchService) {
      $scope.destination = $routeParams.destination;
      $scope.posts = [];
      $scope.predicate = 'score';
      $scope.user = null;
      getUser().then(function(data) {
        return $scope.user = data.data;
      }).then(function() {
        $scope.destinations = {
          'user': getPosts($scope.user ? $scope.user.id : 0),
          'all': getHighRate
        };
        return $scope.action();
      });
      $scope.filteringTag = 'test';
      $scope.action = function() {
        $scope.destinations[$scope.destination].get().then(function(posts) {
          $scope.posts = posts.data;
        }, function(err) {
          console.log(err.data);
        });
      };
      console.log("POSTS = ", SearchService.posts);
      $scope.changeRating = function(post, inc) {
        var rating;
        rating = {
          id: post.id,
          score: inc
        };
        console.log(rating);
        sendRating(rating).success(function(res) {
          console.log(res);
          post.score = res.score;
        }).error(function() {
          return console.log("already rated");
        });
      };
      $scope.order = function(predicate) {
        return $scope.predicate = predicate;
      };
    }
  ]);

}).call(this);

//# sourceMappingURL=main_page_controller.js.map
